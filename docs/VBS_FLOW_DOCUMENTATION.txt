VBS FLOW DOCUMENTATION
======================

OVERVIEW
--------
The VBS flow handles automated interaction with the VBS ERP system for data upload and PDF report generation through precise window automation and LLM-enhanced decision making.

PHASES BREAKDOWN
----------------

PHASE 1: LOGIN AUTHENTICATION
- File: vbs/vbs_phase1_login.py
- Purpose: Secure login to VBS system
- Duration: 2-3 minutes
- LLM Integration: Login validation and error recovery

PHASE 2: NAVIGATION TO WIFI USER REGISTRATION
- File: vbs/vbs_phase2_navigation.py  
- Purpose: Navigate through VBS menus to WiFi User Registration
- Duration: 3-5 minutes
- LLM Integration: Dynamic path optimization and timing adjustments

PHASE 3: DATA UPLOAD AND IMPORT
- File: vbs/vbs_phase3_upload.py
- Purpose: Import Excel data and process updates
- Duration: 30 minutes - 2 hours (depending on data volume)
- LLM Integration: File selection optimization and progress monitoring

PHASE 4: PDF REPORT GENERATION
- File: vbs/vbs_phase4_report.py
- Purpose: Generate and export PDF reports
- Duration: 5-10 minutes
- LLM Integration: Date range optimization and file naming

DETAILED PHASE BREAKDOWN
-------------------------

PHASE 1: LOGIN AUTHENTICATION
------------------------------
Coordinates:
- Username field: (400, 300)
- Password field: (400, 340) 
- Login button: (400, 380)

Process:
1. Detect VBS login window
2. Input credentials securely
3. Handle authentication errors
4. Validate successful login
5. Wait for main interface load

Error Handling:
- Invalid credentials: Retry with backup
- Login timeout: Increase wait time
- Captcha detection: Manual intervention
- Network issues: Reconnection attempts

PHASE 2: NAVIGATION
-------------------
Coordinates:
- Arrow button: (31, 66)
- Sales & Distribution: (132, 165)
- POS: (159, 598)
- WiFi User Registration: (288, 679) - DOUBLE CLICK REQUIRED
- New button: (104, 107)

Process:
1. Click arrow to open main menu
2. Navigate to Sales & Distribution
3. Click POS submenu
4. DOUBLE-CLICK WiFi User Registration (CRITICAL)
5. Click New button to create entry

LLM Enhancements:
- Dynamic coordinate validation
- Alternative selector generation
- Timing optimization based on system performance
- Error context analysis for recovery strategies

PHASE 3: DATA UPLOAD
---------------------
Coordinates:
- Import EHC checkbox: (1194, 692)
- 3 dots button: (785, 658)
- Dropdown button: (626, 688)
- Sheet1 selection: (432, 715)
- Import button: (704, 688)
- Table header: (256, 735)
- Update button: (548, 897)

Process:
1. Press RIGHT arrow to activate radio button
2. Click Import EHC checkbox
3. Click 3 dots for file selection
4. Navigate to Excel file (auto-detected)
5. Select dropdown for Sheet1
6. Click Import button
7. Press Enter to clear success popup
8. Click table header to refresh
9. Click Update and monitor progress (30min-2hrs)
10. Listen for completion sound (click+pop)
11. Close application for restart

File Selection Methods:
- Clipboard method (primary)
- Direct typing (fallback)
- Navigation method (last resort)

Audio Monitoring:
- Advanced audio detection system
- Fallback time-based detection
- Success sound pattern recognition

PHASE 4: PDF GENERATION
-----------------------
Coordinates:
- Arrow button: (31, 66)
- Sales & Distribution: (132, 165)
- Reports: (157, 646)
- POS Reports: (187, 934)
- Print button: (114, 110)
- Export button: (74, 55)

Process:
1. Login again after Phase 3 restart
2. Navigate to Sales & Distribution
3. Move to Reports submenu
4. Scroll down 2x to reach POS
5. Scroll 1x + 5 TABs + ENTER for PDF interface
6. Input date range (01/MM/YYYY to current date)
7. Click Print and wait 20 seconds
8. Click Export button
9. Navigate to previous day folder for naming template
10. Generate filename: "MoonFlower Active Users {date}.pdf"
11. Navigate to current date folder
12. Save PDF with proper naming

Date Logic:
- From Date: 01 + current month + current year
- To Date: Current day when CSV was downloaded
- Filename: MoonFlower Active Users Count_{DD}_{MM}_{YYYY}.pdf

LLM INTEGRATION FEATURES
------------------------

1. ADAPTIVE TIMING
- Historical performance analysis
- Dynamic wait time adjustment
- System load consideration
- Network latency compensation

2. ERROR ANALYSIS
- Context-aware error interpretation
- Recovery strategy generation
- Alternative approach suggestions
- Pattern recognition for recurring issues

3. ELEMENT DETECTION
- Dynamic selector generation
- Fallback coordinate calculation
- Visual pattern recognition
- Accessibility-based targeting

4. PROGRESS MONITORING
- Real-time status assessment
- Completion prediction
- Anomaly detection
- Performance optimization

COORDINATE SYSTEMS
------------------
VBS Window Coordinates: Relative to VBS application window
Screen Coordinates: Absolute screen positions (provided as reference)

All automation uses VBS window coordinates for consistency across different screen configurations.

ERROR HANDLING STRATEGIES
--------------------------

1. COORDINATE FAILURES
- Try primary coordinate
- Attempt fallback coordinates
- Use LLM-generated alternatives
- Keyboard navigation fallback

2. TIMING ISSUES
- Adaptive wait time adjustment
- Progress indication monitoring
- Timeout extension for slow operations
- Retry with increased intervals

3. WINDOW MANAGEMENT
- Automatic window detection
- Focus restoration
- Size and position validation
- Multi-monitor support

4. DATA VALIDATION
- File existence verification
- Content integrity checks
- Import success confirmation
- Export validation

INTEGRATION WITH OTHER SYSTEMS
-------------------------------
- Input: Excel files from merger process
- Output: PDF reports for email system
- Triggers: Post-CSV processing
- Dependencies: VBS ERP application
- Notifications: Progress updates and completion status

MONITORING & MAINTENANCE
------------------------
- Real-time execution logging
- Performance metrics collection
- Error pattern analysis
- Success rate tracking
- LLM decision audit trail

TROUBLESHOOTING GUIDE
---------------------
1. Double-click not working: Check system double-click timing settings
2. File selection failing: Verify file paths and permissions
3. Update process hanging: Monitor audio detection and manual intervention
4. PDF generation failing: Check date format and export permissions
5. Window focus issues: Restart VBS application and retry

SECURITY CONSIDERATIONS
-----------------------
- Credential encryption at rest
- Session timeout handling
- Audit trail maintenance
- Access control validation
- Data privacy compliance