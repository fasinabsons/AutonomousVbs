VBS Phase 4: PDF Report Generation Documentation
==================================================

PURPOSE:
Generate and export PDF reports from VBS application with precise date handling and file management.

TECHNOLOGY USED:
- PyAutoGUI with high-precision clicking for small UI elements
- PDF window detection for multi-window automation
- Date triad navigation for precise date field handling
- Address bar integration using Phase 3 proven methodology
- PathManager for consistent PDF folder management

PROCESS FLOW:
1. Menu Navigation to Reports
   - Click Arrow Button (01_arrow_button.png) - same as Phase 2
   - Click "Sales & Distribution" (02_sales_distribution_menu.png)
   - Click "Reports" Menu (03_reports_menu.png)
   - Wait for Reports submenu to expand

2. WiFi Active Users Count Navigation
   - Use 54 DOWN arrow key presses after clicking Reports
   - This directly navigates to "WiFi Active Users Count" option
   - Press ENTER to select (no double-click needed)
   - Wait 3 seconds for form to load completely
   - More reliable than scrolling and image detection

3. Date Range Configuration (Triad Navigation)
   FROM Date Setup (Start of Month):
   - Form opens with cursor at FROM date day field (01)
   - Press RIGHT arrow to move to month field
   - Clear and type current month (MM)
   - Press RIGHT arrow to move to year field
   - Clear and type current year (YYYY)
   - Result: 01/MM/YYYY (start of current month)
   
   TO Date Setup (Current Date):
   - Press TAB to move to TO date field
   - Type current day (DD)
   - Press RIGHT arrow to move to month field
   - Clear and type current month (MM)
   - Press RIGHT arrow to move to year field
   - Clear and type current year (YYYY)
   - Result: DD/MM/YYYY (current date)

4. Report Generation
   - Click Print Button (08_print_button.png)
   - Wait EXACTLY 1 MINUTE (60 seconds) for PDF generation
   - This is critical - PDF generation requires full minute
   - Do not interrupt this process

5. PDF Window Detection and Export
   - Automatically detect new PDF report window
   - Search for windows containing "absons", "report", "pdf", "active users"
   - Focus the PDF report window (different from main VBS window)
   - Click Export Button with HIGH PRECISION (09_export_button.png)
   - Export button is very small (red arrow) - needs 0.9 confidence
   - Use micro-offsets for precise clicking

6. Export Dialog Handling
   - Click first OK button (10_export_ok_button.png) or press ENTER
   - Handle format selector dialog if appears
   - Click second OK button (11_format_selector_ok.png) or press ENTER
   - Ensure PDF format is selected (default)

7. File Saving Process (Phase 3 Address Bar Method)
   - Double-click address bar (12_address_bar.png) if visible
   - Use Ctrl+L as fallback to focus address bar
   - Clear and type PDF folder path:
     C:/Users/Lenovo/Documents/Automate2/Automata2/EHC_Data_Pdf/24jul
   - Press ENTER to navigate to folder

8. Filename Entry and Save
   - Click filename entry field (13_filename_entry_field.png)
   - Clear existing text with Ctrl+A
   - Type filename: moonflower active users_DD_MM_YYYY
   - Do NOT include .pdf extension (Windows adds automatically)
   - Click Save button (14_windows_save_button.png)
   - Wait 2 seconds for file to save

9. Application Closure
   - Close VBS application using Win32 WM_CLOSE message
   - Wait 2 seconds for close popup to appear
   - Look for app close popup (15_appclose_yes_button.png)
   - Click Yes button or press ENTER as fallback
   - Wait 1 second for application to fully close

CRITICAL FEATURES:
- **PDF Window Detection**: Automatically finds new report windows
- **High-Precision Clicking**: 0.9 confidence + micro-offsets for tiny buttons
- **Triad Date Navigation**: RIGHT arrow navigation within date fields
- **54 Arrow Navigation**: Direct menu navigation without scrolling
- **Address Bar Integration**: Uses proven Phase 3 navigation method
- **1-Minute Print Wait**: Critical timing for PDF generation

TIMING REQUIREMENTS:
- 3 seconds wait after WiFi Users Count selection
- 1 MINUTE (60 seconds) wait after Print button
- 2 seconds wait for file save completion
- 2 seconds wait for app close popup
- Total execution time: ~2-3 minutes

DATE HANDLING SPECIFICS:
- FROM Date: Always 01/[current_month]/[current_year]
- TO Date: [current_day]/[current_month]/[current_year]
- Uses RIGHT arrow for precise field navigation
- Clears each field completely before typing
- Ensures accurate date entry regardless of cursor position

HIGH-PRECISION CLICKING DETAILS:
- Export button is very small (cursor-size icon)
- Uses 0.9 confidence threshold instead of standard 0.8
- Applies random micro-offsets (-2 to +2 pixels) for reliability
- Multiple attempts with shorter intervals (0.25 seconds)
- Essential for successful export operation

PDF WINDOW DETECTION STRATEGY:
- Enumerates all visible windows
- Searches for VBS-related titles
- Excludes main VBS window (different from report window)
- Focuses report window before clicking export
- Handles multiple window automation scenarios

ADDRESS BAR OPTIMIZATION:
- Uses same proven method as Phase 3
- Double-click address bar first
- Ctrl+L as reliable fallback
- Types complete folder path directly
- Eliminates manual folder navigation

ERROR HANDLING:
- PDF window not found: Fallback to original VBS window
- Export button not found: Retry with different confidence levels
- Address bar not clickable: Use Ctrl+L method
- Save button timeout: Press ENTER as fallback
- App close popup missing: Continue without confirmation

FILENAME FORMAT:
- Base: "moonflower active users"
- Date suffix: "_DD_MM_YYYY" (e.g., "_24_07_2025")
- Extension: Windows adds .pdf automatically
- Example: "moonflower active users_24_07_2025.pdf"

INTEGRATION WITH PATH MANAGER:
- Uses centralized PathManager for PDF directory
- Automatically creates date-specific folders
- Consistent with main automation system structure
- Today's folder format: DDmmm (e.g., 24jul)

REQUIREMENTS FULFILLMENT:
- Generates PDF reports from VBS application
- Uses precise date range (start of month to current date)
- Saves to correct date-specific folder
- Handles all popup confirmations
- Closes application cleanly
- Provides completion confirmation

INTEGRATION:
- Called after: Upload completion (2 hours after Phase 3)
- Requires: VBS application available (may need restart)
- Output: PDF file in EHC_Data_Pdf/24jul/
- Next step: Email delivery of PDF report
- Completion: VBS application closed, PDF ready for email 